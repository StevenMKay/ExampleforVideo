<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"> <!-- Sets character encoding for proper text display -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Makes site responsive on mobile -->
    <title>Call Center Training - Educational Version</title> <!-- Page title shown in browser tab -->
    
    <!-- Font Awesome for professional icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Reset default browser styles for consistency across browsers */
        * {
            margin: 0;           /* Remove default margins */
            padding: 0;          /* Remove default padding */
            box-sizing: border-box; /* Include borders in element sizing */
        }

        /* Main body styling - sets font and background */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Professional font stack */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);   /* Gradient background */
            min-height: 100vh;  /* Full viewport height */
            color: #333;         /* Dark gray text color */
        }

        /* CSS Grid layout for main dashboard structure */
        .dashboard {
            display: grid;                              /* Use CSS Grid layout */
            grid-template-columns: 300px 1fr 350px;   /* Left sidebar, main area, right panel */
            grid-template-rows: 70px 1fr;             /* Header row, main content row */
            height: 100vh;                             /* Full viewport height */
            gap: 1px;                                  /* Small gap between grid areas */
            background: #fff;                          /* White background */
        }

        /* Header spans across all columns at top */
        .header {
            grid-column: 1 / -1;                       /* Span from first to last column */
            background: linear-gradient(135deg, #2c3e50, #3498db); /* Professional gradient */
            color: white;                              /* White text */
            display: flex;                             /* Flexbox for alignment */
            align-items: center;                       /* Center items vertically */
            padding: 0 20px;                          /* Horizontal padding */
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);  /* Subtle shadow for depth */
        }

        /* Header title styling */
        .header h1 {
            font-size: 24px;        /* Large font for title */
            margin-right: auto;     /* Push other elements to the right */
        }

        /* Container for agent information in header */
        .agent-info {
            display: flex;          /* Flexbox layout */
            align-items: center;    /* Center vertically */
            gap: 15px;             /* Space between elements */
        }

        /* Agent status indicator (Available/Busy) */
        .agent-status {
            padding: 8px 16px;     /* Internal spacing */
            border-radius: 20px;   /* Rounded corners */
            background: #27ae60;   /* Green for available */
            font-size: 14px;       /* Smaller font */
            font-weight: 600;      /* Bold text */
        }

        /* Left sidebar for customer queue */
        .sidebar {
            background: #f8f9fa;           /* Light gray background */
            border-right: 1px solid #dee2e6; /* Right border */
            padding: 20px;                  /* Internal spacing */
            overflow-y: auto;               /* Scroll if content overflows */
        }

        /* Spacing between sections in sidebar */
        .queue-section {
            margin-bottom: 30px;    /* Space below each section */
        }

        /* Section titles in sidebar */
        .section-title {
            font-size: 16px;        /* Medium font size */
            font-weight: 600;       /* Bold text */
            margin-bottom: 15px;    /* Space below title */
            color: #2c3e50;         /* Dark blue color */
            display: flex;          /* Flexbox for icon alignment */
            align-items: center;    /* Center icon and text */
            gap: 8px;              /* Space between icon and text */
        }

        /* Individual customer cards in queue */
        .customer-card {
            background: white;                      /* White background */
            border-radius: 8px;                    /* Rounded corners */
            padding: 15px;                         /* Internal spacing */
            margin-bottom: 10px;                   /* Space between cards */
            border-left: 4px solid #3498db;       /* Blue accent border */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Subtle shadow */
            cursor: pointer;                        /* Pointer cursor on hover */
            transition: all 0.3s ease;             /* Smooth hover animation */
        }

        /* Hover effect for customer cards */
        .customer-card:hover {
            transform: translateX(5px);            /* Slide right slightly */
            box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* Stronger shadow */
        }

        /* Active (selected) customer card styling */
        .customer-card.active {
            border-left-color: #e74c3c;    /* Red accent for active */
            background: #fff5f5;           /* Light red background */
        }

        /* Customer name in card */
        .customer-name {
            font-weight: 600;      /* Bold text */
            margin-bottom: 5px;    /* Space below name */
        }

        /* Request type description */
        .request-type {
            font-size: 12px;       /* Small font */
            color: #7f8c8d;        /* Gray color */
            margin-bottom: 8px;    /* Space below text */
        }

        /* Priority indicators (High, Medium, Low) */
        .priority {
            display: inline-block;  /* Inline but with block properties */
            padding: 2px 8px;      /* Small internal spacing */
            border-radius: 12px;   /* Rounded pill shape */
            font-size: 11px;       /* Very small font */
            font-weight: 600;      /* Bold text */
        }

        /* Priority level colors */
        .priority.high { background: #fee; color: #e74c3c; }    /* Red for high */
        .priority.medium { background: #fff5e6; color: #f39c12; } /* Orange for medium */
        .priority.low { background: #eef7ff; color: #3498db; }   /* Blue for low */

        /* Main content area (center column) */
        .main-content {
            display: flex;          /* Flexbox layout */
            flex-direction: column; /* Stack elements vertically */
            background: white;      /* White background */
        }

        /* Chat header showing current customer */
        .chat-header {
            padding: 20px;                      /* Internal spacing */
            border-bottom: 1px solid #dee2e6;  /* Bottom border */
            background: #f8f9fa;               /* Light gray background */
        }

        /* Container for customer details in header */
        .customer-details {
            display: flex;              /* Flexbox layout */
            justify-content: space-between; /* Space between items */
            align-items: center;        /* Center vertically */
        }

        /* Customer info section */
        .customer-info h3 {
            margin-bottom: 5px;     /* Space below name */
        }

        /* Account number styling */
        .account-number {
            font-size: 14px;                           /* Medium font */
            color: #7f8c8d;                            /* Gray color */
            font-family: 'Courier New', monospace;     /* Monospace font for numbers */
        }

        /* Verification status badge */
        .verification-status {
            padding: 8px 16px;     /* Internal spacing */
            border-radius: 20px;   /* Rounded corners */
            font-size: 12px;       /* Small font */
            font-weight: 600;      /* Bold text */
        }

        /* Status colors */
        .verified { background: #d4edda; color: #155724; }   /* Green for verified */
        .pending { background: #fff3cd; color: #856404; }    /* Yellow for pending */

        /* Chat messages container */
        .chat-container {
            flex: 1;                /* Take up remaining space */
            padding: 20px;          /* Internal spacing */
            overflow-y: auto;       /* Scroll if messages overflow */
            background: #fafafa;    /* Very light gray background */
        }

        /* Individual message styling */
        .message {
            margin-bottom: 15px;    /* Space between messages */
            display: flex;          /* Flexbox layout */
            align-items: flex-start; /* Align to top */
            gap: 10px;             /* Space between elements */
        }

        /* Customer messages aligned to right */
        .message.customer {
            flex-direction: row-reverse; /* Reverse order for right alignment */
        }

        /* Message content bubble */
        .message-content {
            max-width: 70%;         /* Don't take full width */
            padding: 12px 16px;     /* Internal spacing */
            border-radius: 18px;    /* Rounded bubble shape */
            position: relative;     /* For positioning */
        }

        /* Agent message styling (blue) */
        .message.agent .message-content {
            background: #3498db;           /* Blue background */
            color: white;                  /* White text */
            border-bottom-left-radius: 4px; /* Sharp corner for tail effect */
        }

        /* Customer message styling (white) */
        .message.customer .message-content {
            background: white;                  /* White background */
            border: 1px solid #dee2e6;        /* Gray border */
            border-bottom-right-radius: 4px;   /* Sharp corner for tail effect */
        }

        /* Timestamp styling */
        .message-time {
            font-size: 11px;       /* Very small font */
            opacity: 0.7;          /* Semi-transparent */
            margin-top: 5px;       /* Space above timestamp */
        }

        /* Input area at bottom of chat */
        .input-area {
            padding: 20px;                      /* Internal spacing */
            border-top: 1px solid #dee2e6;     /* Top border */
            background: white;                  /* White background */
        }

        /* Quick response buttons */
        .quick-responses {
            display: flex;          /* Flexbox layout */
            gap: 10px;             /* Space between buttons */
            margin-bottom: 15px;   /* Space below buttons */
            flex-wrap: wrap;       /* Wrap to new line if needed */
        }

        /* Individual quick response button */
        .quick-btn {
            padding: 6px 12px;         /* Internal spacing */
            background: #e9ecef;       /* Light gray background */
            border: none;              /* No border */
            border-radius: 15px;       /* Rounded corners */
            font-size: 12px;           /* Small font */
            cursor: pointer;           /* Pointer cursor */
            transition: all 0.2s;      /* Smooth hover transition */
        }

        /* Quick button hover effect */
        .quick-btn:hover {
            background: #3498db;   /* Blue background on hover */
            color: white;          /* White text on hover */
        }

        /* Message input container */
        .message-input {
            display: flex;  /* Flexbox layout */
            gap: 10px;     /* Space between input and button */
        }

        /* Text input field */
        .message-input input {
            flex: 1;                        /* Take up remaining space */
            padding: 12px;                  /* Internal spacing */
            border: 1px solid #dee2e6;     /* Gray border */
            border-radius: 25px;           /* Rounded corners */
            outline: none;                  /* Remove focus outline */
        }

        /* Send button */
        .send-btn {
            padding: 12px 20px;    /* Internal spacing */
            background: #3498db;   /* Blue background */
            color: white;          /* White text */
            border: none;          /* No border */
            border-radius: 25px;   /* Rounded corners */
            cursor: pointer;       /* Pointer cursor */
            font-weight: 600;      /* Bold text */
        }

        /* Right panel for customer info and actions */
        .right-panel {
            background: #f8f9fa;               /* Light gray background */
            border-left: 1px solid #dee2e6;   /* Left border */
            padding: 20px;                     /* Internal spacing */
            overflow-y: auto;                  /* Scroll if content overflows */
        }

        /* Sections within right panel */
        .panel-section {
            margin-bottom: 25px;    /* Space between sections */
        }

        /* Account summary card */
        .account-summary {
            background: white;                      /* White background */
            border-radius: 8px;                    /* Rounded corners */
            padding: 15px;                         /* Internal spacing */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Subtle shadow */
        }

        /* Individual balance items */
        .balance-item {
            display: flex;                  /* Flexbox layout */
            justify-content: space-between; /* Space between label and amount */
            padding: 8px 0;                /* Vertical spacing */
            border-bottom: 1px solid #f0f0f0; /* Bottom border */
        }

        /* Last balance item (no border) */
        .balance-item:last-child {
            border-bottom: none;    /* Remove bottom border */
            font-weight: 600;       /* Bold text */
        }

        /* Action buttons container */
        .transaction-actions {
            display: flex;          /* Flexbox layout */
            flex-direction: column; /* Stack buttons vertically */
            gap: 10px;             /* Space between buttons */
        }

        /* Individual action button */
        .action-btn {
            padding: 12px;             /* Internal spacing */
            border: 1px solid #3498db; /* Blue border */
            background: white;         /* White background */
            color: #3498db;           /* Blue text */
            border-radius: 6px;       /* Rounded corners */
            cursor: pointer;          /* Pointer cursor */
            font-weight: 600;         /* Bold text */
            transition: all 0.2s;     /* Smooth hover transition */
        }

        /* Action button hover effect */
        .action-btn:hover {
            background: #3498db;   /* Blue background on hover */
            color: white;          /* White text on hover */
        }

        /* Primary action button (different styling) */
        .action-btn.primary {
            background: #3498db;   /* Blue background */
            color: white;          /* White text */
        }

        /* Performance metrics grid */
        .performance-metrics {
            display: grid;                          /* CSS Grid layout */
            grid-template-columns: repeat(2, 1fr);  /* Two equal columns */
            gap: 15px;                              /* Space between items */
            margin-bottom: 20px;                    /* Space below metrics */
        }

        /* Individual metric card */
        .metric-card {
            background: white;                      /* White background */
            padding: 15px;                         /* Internal spacing */
            border-radius: 8px;                    /* Rounded corners */
            text-align: center;                    /* Center text */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Subtle shadow */
        }

        /* Metric value (large number) */
        .metric-value {
            font-size: 24px;       /* Large font */
            font-weight: 600;      /* Bold text */
            color: #3498db;        /* Blue color */
        }

        /* Metric label (description) */
        .metric-label {
            font-size: 12px;       /* Small font */
            color: #7f8c8d;        /* Gray color */
            margin-top: 5px;       /* Space above label */
        }

        /* Responsive design for smaller screens */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 250px 1fr 300px; /* Smaller sidebar and panel */
            }
        }

        /* Verification Modal Styles */
        .modal {
            display: none;              /* Hidden by default */
            position: fixed;            /* Fixed positioning */
            top: 0;                     /* Top of viewport */
            left: 0;                    /* Left of viewport */
            width: 100%;                /* Full width */
            height: 100%;               /* Full height */
            background: rgba(0,0,0,0.5); /* Semi-transparent background */
            z-index: 1000;              /* Above other elements */
        }

        /* Modal content container */
        .modal-content {
            position: absolute;                     /* Absolute positioning */
            top: 50%;                              /* Center vertically */
            left: 50%;                             /* Center horizontally */
            transform: translate(-50%, -50%);      /* Adjust for exact centering */
            background: white;                     /* White background */
            border-radius: 10px;                  /* Rounded corners */
            padding: 30px;                        /* Internal spacing */
            width: 90%;                           /* Responsive width */
            max-width: 500px;                     /* Maximum width */
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* Strong shadow */
        }

        /* Modal header with title and close button */
        .modal-header {
            display: flex;              /* Flexbox layout */
            justify-content: space-between; /* Space between title and close button */
            align-items: center;        /* Center vertically */
            margin-bottom: 20px;        /* Space below header */
        }

        /* Close button styling */
        .close-btn {
            background: none;           /* No background */
            border: none;              /* No border */
            font-size: 24px;          /* Large font for X */
            cursor: pointer;           /* Pointer cursor */
            color: #7f8c8d;           /* Gray color */
        }

        /* Form group container */
        .form-group {
            margin-bottom: 20px;       /* Space between form fields */
        }

        /* Form labels */
        .form-group label {
            display: block;            /* Block level element */
            margin-bottom: 5px;        /* Space below label */
            font-weight: 600;          /* Bold text */
        }

        /* Form inputs */
        .form-group input, .form-group select {
            width: 100%;               /* Full width */
            padding: 10px;             /* Internal spacing */
            border: 1px solid #dee2e6; /* Gray border */
            border-radius: 6px;        /* Rounded corners */
            outline: none;             /* Remove focus outline */
        }

        /* Mobile responsive design */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;                    /* Single column */
                grid-template-rows: 70px auto auto auto;       /* Stack vertically */
            }
            
            .sidebar, .right-panel {
                display: none; /* Hide side panels on mobile */
            }
        }
    </style>
</head>
<body>
    <!-- Main dashboard container using CSS Grid -->
    <div class="dashboard">
        <!-- Header section spanning full width -->
        <div class="header">
            <!-- Main title with icon -->
            <h1><i class="fas fa-headset"></i> SecureBank Call Center</h1>
            <!-- Agent information and status -->
            <div class="agent-info">
                <span>Agent: <strong>Training Mode</strong></span> <!-- Show we're in training -->
                <span class="agent-status">Available</span> <!-- Agent status indicator -->
                <span><i class="fas fa-clock"></i> <span id="currentTime">14:32</span></span> <!-- Current time -->
            </div>
        </div>

        <!-- Left sidebar for customer queue -->
        <div class="sidebar">
            <!-- Performance metrics at top -->
            <div class="performance-metrics">
                <div class="metric-card">
                    <div class="metric-value" id="callsHandled">0</div> <!-- Counter for calls handled -->
                    <div class="metric-label">Calls Today</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avgResponseTime">0:00</div> <!-- Average response time -->
                    <div class="metric-label">Avg Response</div>
                </div>
            </div>

            <!-- Customer queue section -->
            <div class="queue-section">
                <div class="section-title">
                    <i class="fas fa-users"></i> <!-- Users icon -->
                    Customer Queue (<span id="queueCount">3</span>) <!-- Dynamic queue count -->
                </div>
                <div id="customerQueue">
                    <!-- Customer cards will be generated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Main content area for chat -->
        <div class="main-content">
            <!-- Chat header showing current customer info -->
            <div class="chat-header" id="chatHeader">
                <div class="customer-details">
                    <div class="customer-info">
                        <h3 id="currentCustomerName">Select a customer to begin</h3> <!-- Current customer name -->
                        <div class="account-number" id="currentAccountNumber"></div> <!-- Account number -->
                    </div>
                    <!-- Verification status badge -->
                    <div class="verification-status pending" id="verificationStatus">
                        <i class="fas fa-shield-alt"></i> Verification Required
                    </div>
                </div>
            </div>

            <!-- Chat messages container -->
            <div class="chat-container" id="chatContainer">
                <!-- Welcome message when no customer selected -->
                <div style="text-align: center; color: #7f8c8d; margin-top: 100px;">
                    <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 20px;"></i>
                    <h3>Welcome to SecureBank Call Center Training</h3>
                    <p>Select a customer from the queue to start practicing</p>
                </div>
            </div>

            <!-- Input area for sending messages -->
            <div class="input-area">
                <!-- Quick response buttons for common phrases -->
                <div class="quick-responses">
                    <button class="quick-btn" onclick="addQuickResponse('Thank you for calling SecureBank. Before I can assist you, I need to verify your identity for security purposes.')">Security Greeting</button>
                    <button class="quick-btn" onclick="addQuickResponse('Can you please provide your date of birth?')">Ask DOB</button>
                    <button class="quick-btn" onclick="addQuickResponse('What is your mother\'s maiden name?')">Ask Maiden Name</button>
                    <button class="quick-btn" onclick="addQuickResponse('Thank you! Identity verified. How can I help you today?')">Verification Complete</button>
                </div>
                <!-- Message input field and send button -->
                <div class="message-input">
                    <input type="text" id="messageInput" placeholder="Select a customer to begin..." disabled> <!-- Message input -->
                    <button class="send-btn" onclick="sendMessage()" disabled> <!-- Send button -->
                        <i class="fas fa-paper-plane"></i> <!-- Send icon -->
                    </button>
                </div>
            </div>
        </div>

        <!-- Right panel for customer information and actions -->
        <div class="right-panel">
            <!-- Customer profile section -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-user"></i> <!-- User icon -->
                    Customer Profile
                </div>
                <div id="customerProfile">
                    <!-- Default message when no customer selected -->
                    <p style="color: #7f8c8d; text-align: center; margin-top: 50px;">
                        Select a customer to view their profile
                    </p>
                </div>
            </div>

            <!-- Account summary section -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-university"></i> <!-- Bank icon -->
                    Account Summary
                </div>
                <div class="account-summary" id="accountSummary">
                    <!-- Account balance information -->
                    <div class="balance-item">
                        <span>Checking Balance:</span>
                        <span id="checkingBalance">-</span> <!-- Will show *** until verified -->
                    </div>
                    <div class="balance-item">
                        <span>Savings Balance:</span>
                        <span id="savingsBalance">-</span> <!-- Will show *** until verified -->
                    </div>
                    <div class="balance-item">
                        <span>Credit Available:</span>
                        <span id="creditAvailable">-</span> <!-- Will show *** until verified -->
                    </div>
                </div>
            </div>

            <!-- Quick actions section -->
            <div class="panel-section">
                <div class="section-title">
                    <i class="fas fa-cog"></i> <!-- Settings icon -->
                    Quick Actions
                </div>
                <div class="transaction-actions">
                    <!-- Action buttons for common tasks -->
                    <button class="action-btn" onclick="openVerificationModal()">
                        <i class="fas fa-shield-alt"></i> Verify Identity
                    </button>
                    <button class="action-btn" onclick="showTransactionInfo()">
                        <i class="fas fa-exchange-alt"></i> Process Transaction
                    </button>
                    <button class="action-btn" onclick="showCardInfo()">
                        <i class="fas fa-credit-card"></i> Card Services
                    </button>
                    <button class="action-btn primary" onclick="resolveCase()">
                        <i class="fas fa-check"></i> Resolve Case
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div id="verifyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Identity Verification</h3> <!-- Modal title -->
                <button class="close-btn" onclick="closeModal('verifyModal')">&times;</button> <!-- Close button -->
            </div>
            <!-- Date of birth input field -->
            <div class="form-group">
                <label>Date of Birth:</label>
                <input type="date" id="dobInput"> <!-- HTML5 date picker -->
            </div>
            <!-- SSN input field -->
            <div class="form-group">
                <label>Last 4 digits of SSN:</label>
                <input type="text" id="ssnInput" maxlength="4" placeholder="****"> <!-- Text input with 4 character limit -->
            </div>
            <!-- Mother's maiden name input field -->
            <div class="form-group">
                <label>Mother's Maiden Name:</label>
                <input type="text" id="maidenInput"> <!-- Text input for maiden name -->
            </div>
            <!-- Verify button -->
            <button class="action-btn primary" onclick="verifyCustomer()" style="width: 100%;">
                Verify Customer
            </button>
        </div>
    </div>

    <script>
        /* 
         * CALL CENTER APPLICATION CLASS
         * Main class that handles all call center functionality including customer management,
         * chat interactions, verification processes, and performance tracking
         */
        class CallCenterApp {
            /**
             * Constructor - initializes the application with default values
             * Sets up initial state and calls initialization methods
             */
            constructor() {
                this.currentCustomer = null;        // Currently selected customer object
                this.isVerified = false;            // Whether current customer is verified
                this.chatHistory = [];              // Array of all chat messages
                this.responseTime = 0;              // Time taken to respond to customer
                this.caseStartTime = null;          // When current case started
                this.customerQueue = [];            // Array of customers in queue
                this.performanceMetrics = {         // Performance tracking object
                    callsHandled: 0,                // Number of calls completed today
                    totalResponseTime: 0,           // Sum of all response times
                    averageResponseTime: 0          // Calculated average response time
                };
                
                this.init(); // Start the application
            }

            /**
             * Initialize the application
             * Sets up customers, event listeners, and starts background processes
             */
            init() {
                this.generateRandomCustomers();     // Create random customer data
                this.loadCustomerQueue();           // Display customers in sidebar
                this.setupEventListeners();        // Set up UI interactions
                this.startClock();                  // Start the time display
            }

            /**
             * Generate randomized customer data for training
             * Creates 3 customers with random names, scenarios, and account info
             */
            generateRandomCustomers() {
                // Arrays of possible values for randomization
                const firstNames = ['Sarah', 'Michael', 'Emily', 'Robert', 'Lisa', 'James', 'Amanda', 'David'];
                const lastNames = ['Johnson', 'Chen', 'Rodriguez', 'Thompson', 'Martinez', 'Wilson', 'Davis', 'Brown'];
                const requestTypes = ['Wire Transfer', 'Account Update', 'Card Activation', 'Fraud Report', 'Loan Application'];
                const priorities = ['high', 'medium', 'low'];
                const maidenNames = ['Williams', 'Liu', 'Garcia', 'Smith', 'Lopez', 'Davis', 'Miller', 'Taylor'];
                
                // Clear existing customers
                this.customerQueue = [];
                
                // Generate 3 random customers
                for (let i = 0; i < 3; i++) {
                    // Pick random values from arrays
                    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                    const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                    const requestType = requestTypes[Math.floor(Math.random() * requestTypes.length)];
                    const priority = priorities[Math.floor(Math.random() * priorities.length)];
                    const maidenName = maidenNames[Math.floor(Math.random() * maidenNames.length)];
                    
                    // Generate random dates and account info
                    const birthYear = 1970 + Math.floor(Math.random() * 30);   // Random year between 1970-1999
                    const birthMonth = Math.floor(Math.random() * 12) + 1;      // Random month 1-12
                    const birthDay = Math.floor(Math.random() * 28) + 1;        // Random day 1-28
                    const dob = `${birthYear}-${String(birthMonth).padStart(2, '0')}-${String(birthDay).padStart(2, '0')}`; // Format as YYYY-MM-DD
                    
                    // Generate random account balances
                    const checkingBalance = Math.floor(Math.random() * 10000) + 500;    // $500-$10,500
                    const savingsBalance = Math.floor(Math.random() * 50000) + 1000;     // $1,000-$51,000
                    const creditAvailable = Math.floor(Math.random() * 5000) + 1000;    // $1,000-$6,000
                    
                    // Create customer object with all randomized data
                    const customer = {
                        id: `C${String(i + 1).padStart(3, '0')}`,              // ID like C001, C002, C003
                        name: `${firstName} ${lastName}`,                       // Full name
                        accountNumber: `****${Math.floor(Math.random() * 10000)}`, // Masked account number
                        phone: `(555) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`, // Random phone
                        email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}@email.com`, // Generated email
                        dob: dob,                                               // Date of birth
                        ssn: String(Math.floor(Math.random() * 10000)).padStart(4, '0'), // Last 4 SSN digits
                        maidenName: maidenName,                                 // Mother's maiden name
                        address: `${Math.floor(Math.random() * 9999) + 1} Main Street, Anytown, ST ${Math.floor(Math.random() * 90000) + 10000}`, // Random address
                        checkingBalance: checkingBalance,                       // Checking account balance
                        savingsBalance: savingsBalance,                         // Savings account balance
                        creditAvailable: creditAvailable,                      // Available credit
                        requestType: requestType,                               // Type of request
                        priority: priority,                                     // Priority level
                        joinDate: `${2015 + Math.floor(Math.random() * 8)}-${String(Math.floor(Math.random() * 12) + 1).padStart(2, '0')}-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`, // Random join date
                        waitTime: `${Math.floor(Math.random() * 15) + 1} min`  // Random wait time
                    };
                    
                    this.customerQueue.push(customer); // Add customer to queue
                }
            }

            /**
             * Display customer queue in the sidebar
             * Creates HTML cards for each customer with their information
             */
            loadCustomerQueue() {
                const queueContainer = document.getElementById('customerQueue'); // Get queue container element
                queueContainer.innerHTML = ''; // Clear existing content
                
                // Loop through each customer and create a card
                this.customerQueue.forEach((customer, index) => {
                    const customerCard = document.createElement('div');          // Create card container
                    customerCard.className = 'customer-card';                   // Add CSS class
                    customerCard.onclick = () => this.selectCustomer(customer); // Set click handler
                    
                    // Create HTML content for the card
                    customerCard.innerHTML = `
                        <div class="customer-name">${customer.name}</div>
                        <div class="request-type">${customer.requestType}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                            <span class="priority ${customer.priority}">${customer.priority.toUpperCase()}</span>
                            <span style="font-size: 11px; color: #7f8c8d;">${customer.waitTime}</span>
                        </div>
                    `;
                    
                    queueContainer.appendChild(customerCard); // Add card to container
                });
            }

            /**
             * Set up event listeners for user interactions
             * Handles keyboard input and other UI events
             */
            setupEventListeners() {
                const messageInput = document.getElementById('messageInput'); // Get message input field
                
                // Handle Enter key press to send messages
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) { // If Enter pressed (but not Shift+Enter)
                        e.preventDefault();                  // Prevent default Enter behavior
                        this.sendMessage();                  // Send the message
                    }
                });
            }

            /**
             * Start the clock display in the header
             * Updates the time every second
             */
            startClock() {
                // Function to update time display
                const updateTime = () => {
                    const now = new Date();                                     // Get current date/time
                    const timeString = now.toLocaleTimeString('en-US', {        // Format time as HH:MM
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false 
                    });
                    document.getElementById('currentTime').textContent = timeString; // Update display
                };
                
                updateTime();                           // Update immediately
                setInterval(updateTime, 1000);          // Update every second
            }

            /**
             * Handle customer selection from the queue
             * Sets up the selected customer for interaction
             * @param {Object} customer - The customer object that was selected
             */
            selectCustomer(customer) {
                // Don't do anything if same customer is already selected
                if (this.currentCustomer?.id === customer.id) return;

                // Set up new customer interaction
                this.currentCustomer = customer;        // Set as current customer
                this.isVerified = false;               // Reset verification status
                this.chatHistory = [];                 // Clear chat history
                this.caseStartTime = new Date().getTime(); // Record start time
                
                // Update the user interface
                this.updateCustomerQueue();            // Refresh queue display
                this.updateChatHeader();              // Update chat header
                this.loadCustomerProfile();           // Load customer info panel
                this.initializeChat();               // Start chat conversation
                this.enableInputs();                 // Enable message input
                
                // Simulate customer's first message after a delay
                setTimeout(() => this.simulateCustomerMessage(), 2000);
            }

            /**
             * Update the visual state of the customer queue
             * Highlights the selected customer card
             */
            updateCustomerQueue() {
                const customerCards = document.querySelectorAll('.customer-card'); // Get all customer cards
                
                // Loop through each card and update active state
                customerCards.forEach((card, index) => {
                    if (this.currentCustomer && this.customerQueue[index].id === this.currentCustomer.id) {
                        card.classList.add('active');      // Add active class to selected customer
                    } else {
                        card.classList.remove('active');   // Remove active class from others
                    }
                });
            }

            /**
             * Update the chat header with current customer information
             * Shows customer name, account, and verification status
             */
            updateChatHeader() {
                if (!this.currentCustomer) return; // Exit if no customer selected

                // Update customer name display
                document.getElementById('currentCustomerName').textContent = this.currentCustomer.name;
                // Update account number display
                document.getElementById('currentAccountNumber').textContent = `Account: ${this.currentCustomer.accountNumber}`;
                
                // Update verification status badge
                const verificationStatus = document.getElementById('verificationStatus');
                if (this.isVerified) {
                    verificationStatus.className = 'verification-status verified';          // Green verified badge
                    verificationStatus.innerHTML = '<i class="fas fa-shield-alt"></i> Verified';
                } else {
                    verificationStatus.className = 'verification-status pending';           // Yellow pending badge
                    verificationStatus.innerHTML = '<i class="fas fa-shield-alt"></i> Verification Required';
                }
            }

            /**
             * Load customer profile information in the right panel
             * Shows customer details and account balances immediately for training purposes
             */
            loadCustomerProfile() {
                if (!this.currentCustomer) return; // Exit if no customer selected

                const profileContainer = document.getElementById('customerProfile'); // Get profile container
                const customer = this.currentCustomer;                             // Get current customer
                
                // Create HTML for customer profile
                profileContainer.innerHTML = `
                    <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="margin-bottom: 10px;"><strong>Phone:</strong> ${customer.phone}</div>
                        <div style="margin-bottom: 10px;"><strong>Email:</strong> ${customer.email}</div>
                        <div style="margin-bottom: 10px;"><strong>Address:</strong> ${customer.address}</div>
                        <div style="margin-bottom: 10px;"><strong>Member Since:</strong> ${customer.joinDate}</div>
                        <div><strong>Account Type:</strong> Premium Banking</div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                            <strong>Verification Info (Training Only):</strong><br>
                            <small style="color: #7f8c8d;">DOB: ${new Date(customer.dob + 'T00:00:00').toLocaleDateString('en-US')}<br>
                            Maiden Name: ${customer.maidenName}<br>
                            SSN (Last 4): ${customer.ssn}</small>
                        </div>
                    </div>
                `;

                // Always show account balances in training mode for learning purposes
                document.getElementById('checkingBalance').textContent = `$${customer.checkingBalance.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
                document.getElementById('savingsBalance').textContent = `$${customer.savingsBalance.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
                document.getElementById('creditAvailable').textContent = `$${customer.creditAvailable.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            }

            /**
             * Initialize chat conversation with welcome message
             * Sets up the starting point for customer interaction
             */
            initializeChat() {
                const chatContainer = document.getElementById('chatContainer'); // Get chat container
                
                // Create initial welcome message emphasizing security
                chatContainer.innerHTML = `
                    <div class="message agent">
                        <div class="message-content">
                            <div>Welcome to SecureBank! I can see you're calling about ${this.currentCustomer.requestType}. Before I can assist you, I need to verify your identity for security purposes.</div>
                            <div class="message-time">${this.getCurrentTime()}</div>
                        </div>
                    </div>
                `;
                this.scrollToBottom(); // Scroll to show latest message
            }

            /**
             * Simulate customer's initial message
             * Creates realistic customer response based on their request type
             */
            simulateCustomerMessage() {
                if (!this.currentCustomer) return; // Exit if no customer selected

                // Different opening messages based on request type
                const openingMessages = {
                    'Wire Transfer': "Hi, I need to send an urgent wire transfer to my family member. Can you help me with that?",
                    'Account Update': "Hello, I recently moved and need to update my address and contact information on my account.",
                    'Card Activation': "Hi, I received my new debit card in the mail and need to activate it. Can you help me?",
                    'Fraud Report': "I'm calling because I see some charges on my account that I didn't make. I'm really worried.",
                    'Loan Application': "Hello, I'm interested in applying for a personal loan. What information do you need?"
                };
                
                // Get appropriate message or use default
                const message = openingMessages[this.currentCustomer.requestType] || "Hi, I need help with my account. Can you assist me?";
                
                // Add customer message after a short delay
                setTimeout(() => {
                    this.addMessage(message, 'customer');
                }, 1500);
            }

            /**
             * Send a message from the agent
             * Processes agent input and sends it to the customer
             */
            sendMessage() {
                const input = document.getElementById('messageInput');  // Get input field
                const message = input.value.trim();                    // Get message text and remove whitespace
                
                if (!message) return; // Don't send empty messages

                // Security check - prevent discussing sensitive info before verification
                const lowerMessage = message.toLowerCase();
                const sensitiveKeywords = ['balance', 'account', 'transfer', 'money', 'amount', 'transaction'];
                
                // Block sensitive discussions before verification
                if (!this.isVerified && sensitiveKeywords.some(keyword => lowerMessage.includes(keyword))) {
                    alert('⚠️ Security Alert: You must verify the customer\'s identity before discussing account information or transactions.');
                    return;
                }

                this.addMessage(message, 'agent');     // Add agent message to chat
                input.value = '';                      // Clear input field
                
                // Track response time for performance metrics
                if (this.responseTime === 0) {
                    this.responseTime = new Date().getTime() - this.caseStartTime;
                }

                // Simulate customer response after delay
                setTimeout(() => {
                    this.generateCustomerResponse(message);
                }, 2000 + Math.random() * 2000); // Random delay 2-4 seconds
            }

            /**
             * Add a message to the chat display
             * Creates message bubbles for agent or customer messages
             * @param {string} content - The message text
             * @param {string} sender - Either 'agent' or 'customer'
             */
            addMessage(content, sender) {
                const chatContainer = document.getElementById('chatContainer'); // Get chat container
                const messageDiv = document.createElement('div');              // Create message container
                messageDiv.className = `message ${sender}`;                    // Set CSS classes
                
                // Create HTML for message bubble
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div>${content}</div>
                        <div class="message-time">${this.getCurrentTime()}</div>
                    </div>
                `;

                chatContainer.appendChild(messageDiv); // Add to chat
                this.scrollToBottom();                 // Scroll to show new message

                // Save to chat history
                this.chatHistory.push({
                    content: content,
                    sender: sender,
                    timestamp: new Date()
                });

                // Check for verification info in customer messages
                if (sender === 'customer' && !this.isVerified) {
                    this.checkForAutoVerification(content);
                }
            }

            /**
             * Generate realistic customer responses
             * Creates contextually appropriate responses based on agent messages
             * @param {string} agentMessage - The message the agent just sent
             */
            generateCustomerResponse(agentMessage) {
                if (!this.currentCustomer) return; // Exit if no customer

                let response = '';
                const lowerMessage = agentMessage.toLowerCase(); // Convert to lowercase for keyword matching

                // Handle verification questions specifically
                if (lowerMessage.includes('mother') && lowerMessage.includes('maiden')) {
                    // Agent asked for maiden name - provide correct answer
                    response = `My mother's maiden name is ${this.currentCustomer.maidenName}.`;
                } else if (lowerMessage.includes('date') && lowerMessage.includes('birth')) {
                    // Agent asked for date of birth - provide formatted answer
                    const dobDate = new Date(this.currentCustomer.dob + 'T00:00:00'); // Add time to prevent timezone issues
                    const dobFormatted = dobDate.toLocaleDateString('en-US', {
                        year: 'numeric', month: 'long', day: 'numeric'
                    });
                    response = `My date of birth is ${dobFormatted}.`;
                } else if (lowerMessage.includes('ssn') || lowerMessage.includes('social')) {
                    // Agent asked for SSN - provide last 4 digits
                    response = `The last four digits are ${this.currentCustomer.ssn}.`;
                } else if (lowerMessage.includes('verify') || lowerMessage.includes('identity')) {
                    // Agent mentioned verification
                    if (this.isVerified) {
                        response = "I believe you've already verified my identity. Can we proceed with my request?";
                    } else {
                        response = "Sure, I can provide my information for verification. What do you need?";
                    }
                } else if (lowerMessage.includes('help') || lowerMessage.includes('assist')) {
                    // Agent offered help
                    if (!this.isVerified) {
                        response = "I'd be happy to share that information, but shouldn't you verify my identity first for security?";
                    } else {
                        response = "Yes, thank you! I really need help with this " + this.currentCustomer.requestType.toLowerCase() + ".";
                    }
                } else if (lowerMessage.includes('account') || lowerMessage.includes('balance') || lowerMessage.includes('transfer')) {
                    // Agent mentioned sensitive account info
                    if (!this.isVerified) {
                        response = "I appreciate you looking into that, but I'm concerned you haven't verified who I am yet. Shouldn't we do that first?";
                    } else {
                        response = "That sounds right. What do we need to do next?";
                    }
                } else if (lowerMessage.includes('thank')) {
                    // Agent thanked customer
                    response = "Thank you so much for your help! This really means a lot to me.";
                } else if (this.isVerified) {
                    // After verification, give more detailed responses
                    const detailedResponses = [
                        "Great! Now that you've verified my identity, I feel much more comfortable proceeding.",
                        "Perfect! I really appreciate your help with this.",
                        "Thank you for being so thorough with the security process.",
                        "Excellent! What's the next step?"
                    ];
                    response = detailedResponses[Math.floor(Math.random() * detailedResponses.length)];
                } else {
                    // Before verification, keep responses focused on security
                    response = "I understand, but shouldn't we handle the security verification first?";
                }

                // Add customer response with delay
                setTimeout(() => {
                    this.addMessage(response, 'customer');
                }, 1500);
            }

            /**
             * Check customer messages for verification information
             * Automatically verifies customer when they provide correct info
             * @param {string} customerMessage - The message from the customer
             */
            checkForAutoVerification(customerMessage) {
                if (!this.currentCustomer || this.isVerified) return; // Exit if already verified

                const message = customerMessage.toLowerCase();
                let verificationCount = 0;

                // Check for mother's maiden name
                if (message.includes(this.currentCustomer.maidenName.toLowerCase())) {
                    verificationCount++;
                }

                // Check for date of birth (various formats)
                const dobCheck = message.includes(this.currentCustomer.dob) || 
                                message.includes(new Date(this.currentCustomer.dob).toLocaleDateString()) ||
                                message.includes(new Date(this.currentCustomer.dob + 'T00:00:00').toLocaleDateString('en-US', {year: 'numeric', month: 'long', day: 'numeric'}));
                if (dobCheck) {
                    verificationCount++;
                }

                // Check for SSN
                if (message.includes(this.currentCustomer.ssn)) {
                    verificationCount++;
                }

                // If customer provided sufficient verification info (at least 2 pieces)
                if (verificationCount >= 2) {
                    setTimeout(() => {
                        this.isVerified = true;                    // Mark as verified
                        this.updateChatHeader();                   // Update header display
                        this.loadCustomerProfile();               // Refresh profile to show balances
                        this.addMessage("Thank you! I've successfully verified your identity. Now I can help you with your " + this.currentCustomer.requestType.toLowerCase() + " request. How can I assist you?", 'agent');
                    }, 1500);
                }
            }

            /**
             * Verify customer using modal form
             * Processes the verification form inputs and checks against customer data
             */
            verifyCustomer() {
                if (!this.currentCustomer) return; // Exit if no customer selected

                // Get form input values
                const dobInput = document.getElementById('dobInput').value;      // Date of birth from form
                const ssnInput = document.getElementById('ssnInput').value;     // SSN from form
                const maidenInput = document.getElementById('maidenInput').value; // Maiden name from form

                const customer = this.currentCustomer; // Get current customer for comparison

                // Validate date of birth (compare strings directly to avoid timezone issues)
                if (customer.dob && dobInput) {
                    if (dobInput !== customer.dob) { // Direct string comparison
                        // Show error with expected format
                        const customerDate = new Date(customer.dob + 'T00:00:00'); // Add time to prevent timezone issues
                        const expectedDateStr = customerDate.toLocaleDateString('en-US');
                        alert(`Date of birth does not match our records. Expected: ${expectedDateStr} (Enter as: ${customer.dob})`);
                        return;
                    }
                }

                // Validate SSN (last 4 digits)
                if (customer.ssn && ssnInput !== customer.ssn) {
                    alert('SSN does not match our records.');
                    return;
                }

                // Validate mother's maiden name (case insensitive)
                if (customer.maidenName && maidenInput.toLowerCase() !== customer.maidenName.toLowerCase()) {
                    alert("Mother's maiden name does not match our records.");
                    return;
                }

                // Verification successful!
                this.isVerified = true;                    // Mark customer as verified
                this.updateChatHeader();                   // Update header to show verified status
                this.closeModal('verifyModal');            // Close the verification modal
                
                // Clear form fields for next use
                document.getElementById('dobInput').value = '';
                document.getElementById('ssnInput').value = '';
                document.getElementById('maidenInput').value = '';

                // Add confirmation message to chat
                this.addMessage("Identity verification completed successfully. How can I help you today?", 'agent');
                
                // Simulate customer response after verification
                setTimeout(() => {
                    this.addMessage("Great! Now that you've verified my identity, I feel much more comfortable proceeding.", 'customer');
                }, 2000);
            }

            /**
             * Open verification modal
             * Shows the identity verification form
             */
            openModal(modalId) {
                document.getElementById(modalId).style.display = 'block'; // Show the modal
            }

            /**
             * Close verification modal
             * Hides the identity verification form
             */
            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none'; // Hide the modal
            }

            /**
             * Open verification modal (wrapper function)
             * Opens the identity verification modal for the current customer
             */
            openVerificationModal() {
                if (!this.currentCustomer) {
                    alert('Please select a customer first.');
                    return;
                }
                
                if (this.isVerified) {
                    alert('Customer is already verified.');
                    return;
                }
                
                this.openModal('verifyModal');
            }

            /**
             * Enable message input and send button
             * Called when a customer is selected to allow agent to type
             */
            enableInputs() {
                const messageInput = document.getElementById('messageInput');    // Get input field
                const sendBtn = document.querySelector('.send-btn');            // Get send button
                
                messageInput.disabled = false;                                  // Enable input
                sendBtn.disabled = false;                                       // Enable button
                messageInput.placeholder = "Type your response to the customer..."; // Update placeholder
                messageInput.focus();                                           // Focus on input for immediate typing
            }

            /**
             * Scroll chat container to bottom
             * Ensures latest messages are visible
             */
            scrollToBottom() {
                const chatContainer = document.getElementById('chatContainer'); // Get chat container
                chatContainer.scrollTop = chatContainer.scrollHeight;          // Scroll to bottom
            }

            /**
             * Get current time in HH:MM format
             * Used for message timestamps
             * @returns {string} Time in HH:MM format
             */
            getCurrentTime() {
                return new Date().toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false 
                });
            }

            /**
             * Manually verify customer identity
             * Simplified verification for training purposes
             */
            verifyCustomerManually() {
                if (!this.currentCustomer) {
                    alert('Please select a customer first.');
                    return;
                }

                if (this.isVerified) {
                    alert('Customer is already verified.');
                    return;
                }

                // Simple verification for training - just confirm with agent
                const confirmed = confirm(`Verify identity for ${this.currentCustomer.name}?\n\nIn a real system, you would need to confirm:\n- Date of Birth: ${new Date(this.currentCustomer.dob + 'T00:00:00').toLocaleDateString('en-US')}\n- Mother's Maiden Name: ${this.currentCustomer.maidenName}\n- Last 4 SSN: ${this.currentCustomer.ssn}`);
                
                if (confirmed) {
                    this.isVerified = true;                    // Mark as verified
                    this.updateChatHeader();                   // Update display
                    this.loadCustomerProfile();               // Show account balances
                    this.addMessage("Identity verification completed successfully. How can I help you today?", 'agent');
                    
                    // Simulate customer response
                    setTimeout(() => {
                        this.addMessage("Great! Now that you've verified my identity, I feel much more comfortable proceeding.", 'customer');
                    }, 2000);
                }
            }

            /**
             * Show transaction processing information
             * Educational function to explain transaction types
             */
            showTransactionInfo() {
                if (!this.currentCustomer) {
                    alert('Please select a customer first.');
                    return;
                }

                if (!this.isVerified) {
                    alert('Customer identity must be verified before processing transactions.');
                    return;
                }

                // Show transaction info based on customer's request type
                const transactionInfo = {
                    'Wire Transfer': 'Wire Transfer: Domestic ($25 fee, same day), International ($45 fee, 1-2 business days)',
                    'Account Update': 'Account Update: Address, phone, email changes. May require documentation.',
                    'Card Activation': 'Card Activation: Immediate activation, no fees. Can set PIN after activation.',
                    'Fraud Report': 'Fraud Report: Block card immediately, dispute charges, order replacement card.',
                    'Loan Application': 'Loan Application: Collect income info, credit check, provide loan options.'
                };

                const info = transactionInfo[this.currentCustomer.requestType] || 'General transaction processing.';
                alert(`Transaction Type: ${this.currentCustomer.requestType}\n\n${info}\n\nThis is a training simulation. In a real system, you would process the actual transaction.`);
            }

            /**
             * Show card services information
             * Educational function to explain card-related services
             */
            showCardInfo() {
                if (!this.currentCustomer) {
                    alert('Please select a customer first.');
                    return;
                }

                if (!this.isVerified) {
                    alert('Customer identity must be verified before accessing card services.');
                    return;
                }

                alert(`Card Services for ${this.currentCustomer.name}:\n\n• Activate new cards\n• Report lost/stolen cards\n• Request replacement cards\n• Update PIN\n• Increase credit limits\n• View card transactions\n\nThis is a training simulation. In a real system, you would access the actual card management system.`);
            }

            /**
             * Resolve the current customer case
             * Completes the interaction and updates performance metrics
             */
            resolveCase() {
                if (!this.currentCustomer) {
                    alert('No active customer case to resolve.');
                    return;
                }

                if (!this.isVerified) {
                    alert('Customer identity must be verified before resolving the case.');
                    return;
                }

                // Add final messages to close the case
                this.addMessage("Is there anything else I can help you with today?", 'agent');
                
                setTimeout(() => {
                    this.addMessage("No, that covers everything I needed. Thank you so much for your excellent service!", 'customer');
                    
                    setTimeout(() => {
                        this.addMessage("Thank you for choosing SecureBank. Have a wonderful day!", 'agent');
                        
                        // Update performance metrics
                        this.performanceMetrics.callsHandled++;                                              // Increment calls handled
                        this.performanceMetrics.totalResponseTime += this.responseTime;                     // Add response time
                        this.performanceMetrics.averageResponseTime = this.performanceMetrics.totalResponseTime / this.performanceMetrics.callsHandled; // Calculate average
                        
                        this.updatePerformanceDisplay();    // Update metrics display
                        
                        // Reset for next customer after delay
                        setTimeout(() => {
                            this.resetForNextCustomer();
                        }, 3000);
                        
                    }, 2000);
                }, 2000);
            }

            /**
             * Update performance metrics display
             * Shows updated call count and response times in sidebar
             */
            updatePerformanceDisplay() {
                document.getElementById('callsHandled').textContent = this.performanceMetrics.callsHandled; // Update calls count
                
                // Format average response time as MM:SS
                const avgMinutes = Math.floor(this.performanceMetrics.averageResponseTime / 60000);        // Convert to minutes
                const avgSeconds = Math.floor((this.performanceMetrics.averageResponseTime % 60000) / 1000); // Get remaining seconds
                document.getElementById('avgResponseTime').textContent = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`; // Display as MM:SS
            }

            /**
             * Reset interface for next customer
             * Clears current customer and prepares for new interaction
             */
            resetForNextCustomer() {
                // Reset customer state
                this.currentCustomer = null;        // Clear current customer
                this.isVerified = false;            // Reset verification
                this.chatHistory = [];              // Clear chat history
                this.responseTime = 0;              // Reset response time
                
                // Reset UI elements
                document.getElementById('currentCustomerName').textContent = 'Select a customer to begin';
                document.getElementById('currentAccountNumber').textContent = '';
                document.getElementById('verificationStatus').className = 'verification-status pending';
                document.getElementById('verificationStatus').innerHTML = '<i class="fas fa-shield-alt"></i> Verification Required';
                
                // Reset chat area
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML = `
                    <div style="text-align: center; color: #7f8c8d; margin-top: 100px;">
                        <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>Ready for Next Customer</h3>
                        <p>Select a customer from the queue to continue</p>
                    </div>
                `;
                
                // Disable inputs
                const messageInput = document.getElementById('messageInput');
                const sendBtn = document.querySelector('.send-btn');
                messageInput.disabled = true;                                       // Disable input
                sendBtn.disabled = true;                                            // Disable button
                messageInput.placeholder = "Select a customer to begin...";         // Reset placeholder
                messageInput.value = '';                                            // Clear input

                // Reset customer profile
                document.getElementById('customerProfile').innerHTML = `
                    <p style="color: #7f8c8d; text-align: center; margin-top: 50px;">
                        Select a customer to view their profile
                    </p>
                `;

                // Reset account balances
                document.getElementById('checkingBalance').textContent = '-';
                document.getElementById('savingsBalance').textContent = '-';
                document.getElementById('creditAvailable').textContent = '-';

                // Update queue display
                this.updateCustomerQueue();
            }
        }

        /* 
         * GLOBAL VARIABLES AND FUNCTIONS
         * These functions are called by HTML onclick events and manage the application
         */
        
        let app; // Global variable to hold the application instance

        /**
         * Add quick response text to message input
         * Called by quick response buttons
         * @param {string} message - The predefined message to add
         */
        function addQuickResponse(message) {
            const input = document.getElementById('messageInput');   // Get input field
            input.value = message;                                   // Set the message
            input.focus();                                           // Focus on input field
        }

        /**
         * Send message (called by send button)
         * Wrapper function for the app's sendMessage method
         */
        function sendMessage() {
            if (app) {              // Check if app is initialized
                app.sendMessage();  // Call app's send message method
            }
        }

        /**
         * Open verification modal (called by verify button)
         * Wrapper function for opening the verification modal
         */
        function openVerificationModal() {
            if (app) {                          // Check if app is initialized
                app.openVerificationModal();   // Call app's open modal method
            }
        }

        /**
         * Verify customer (called by modal verify button)  
         * Wrapper function for customer verification
         */
        function verifyCustomer() {
            if (app) {                      // Check if app is initialized
                app.verifyCustomer();       // Call app's verify customer method
            }
        }

        /**
         * Open modal (generic modal opener)
         * Wrapper function for opening any modal
         */
        function openModal(modalId) {
            if (app) {                      // Check if app is initialized
                app.openModal(modalId);     // Call app's open modal method
            }
        }

        /**
         * Close modal (generic modal closer)
         * Wrapper function for closing any modal
         */
        function closeModal(modalId) {
            if (app) {                      // Check if app is initialized
                app.closeModal(modalId);    // Call app's close modal method
            }
        }

        /**
         * Show transaction info (called by transaction button)
         * Wrapper function for transaction information
         */
        function showTransactionInfo() {
            if (app) {                      // Check if app is initialized
                app.showTransactionInfo();  // Call app's transaction info method
            }
        }

        /**
         * Show card info (called by card services button)
         * Wrapper function for card services information
         */
        function showCardInfo() {
            if (app) {                  // Check if app is initialized
                app.showCardInfo();     // Call app's card info method
            }
        }

        /**
         * Resolve case (called by resolve button)
         * Wrapper function for case resolution
         */
        function resolveCase() {
            if (app) {                  // Check if app is initialized
                app.resolveCase();      // Call app's resolve case method
            }
        }

        /**
         * Initialize the application when page loads
         * Creates new CallCenterApp instance and starts the simulation
         */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 Call Center Training Simulation Starting...'); // Log startup
            app = new CallCenterApp();                                      // Create new app instance
            console.log('✅ Application initialized successfully');          // Log success
            
            // Show welcome message in browser console for developers
            console.log('%c🎯 Call Center Training Mode', 'color: #3498db; font-size: 16px; font-weight: bold;');
            console.log('📝 Customer data is randomized each time you reload the page');
            console.log('🔄 Refresh the page to generate new customers and scenarios');
        });

        /**
         * Regenerate customers when page is refreshed
         * This ensures new random data each time for varied training
         */
        window.addEventListener('beforeunload', () => {
            console.log('🔄 Page refreshing - new customers will be generated'); // Log page refresh
        });

        /**
         * Close modals when clicking outside them
         * Improves user experience by allowing easy modal dismissal
         */
        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {    // If clicked on modal backdrop
                event.target.style.display = 'none';           // Hide the modal
            }
        });
    </script>
</body>
</html>
